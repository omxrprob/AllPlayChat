<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AllPlay HQ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>ðŸŽ® AllPlay Team Hub</h1>
        <div id="user-info">
            <span><strong>Your ID:</strong> <code id="user-id"></code></span>
            <button onclick="copyID()">ðŸ“‹ Copy</button>
        </div>
        <nav>
            <button onclick="showTab('chat')">Chat</button>
            <button onclick="showTab('announcements')">Announcements</button>
        </nav>
    </header>

    <main>
        <section id="chat" class="tab active">
            <h2>ðŸ’¬ Team Chat</h2>
            <div id="chat-box"></div>
            <form onsubmit="sendMessage(event)">
                <input type="text" id="username" placeholder="Name (Optional)">
                <input type="text" id="message" placeholder="Type a message..." required>
                <button type="submit">Send</button>
            </form>
        </section>

        <section id="announcements" class="tab">
            <h2>ðŸ“¢ Announcements</h2>
            <ul id="announcement-list"></ul>
            <form onsubmit="postAnnouncement(event)">
                <input type="text" id="announcement" placeholder="Write announcement..." required>
                <button type="submit">Post</button>
            </form>
        </section>
    </main>

    <script>
        let userID = localStorage.getItem("allplay_user_id");
        if (!userID) {
            userID = "user-" + Math.random().toString(36).substring(2, 10);
            localStorage.setItem("allplay_user_id", userID);
        }
        document.getElementById("user-id").textContent = userID;

        function copyID() {
            navigator.clipboard.writeText(userID);
            alert("User ID copied!");
        }

        function copyOtherID(id) {
            navigator.clipboard.writeText(id);
            alert("Copied: " + id);
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
        }

        let mutedUsers = JSON.parse(localStorage.getItem("muted_users") || "[]");

        function loadChat() {
            const chat = JSON.parse(localStorage.getItem("chat")) || [];
            const chatBox = document.getElementById("chat-box");
            chatBox.innerHTML = '';

            chat.forEach(m => {
                if (!mutedUsers.includes(m.userID)) {
                    const p = document.createElement("p");
                    p.innerHTML = `<strong>${m.user}</strong> (${m.userID}) 
                        <button onclick="copyOtherID('${m.userID}')">ðŸ“‹</button>: ${m.msg}`;
                    chatBox.appendChild(p);
                }
            });
        }

        function sendMessage(event) {
            event.preventDefault();
            const nameInput = document.getElementById("username");
            const msgInput = document.getElementById("message");
            const name = nameInput.value.trim() || userID;
            const msg = msgInput.value.trim();
            if (!msg) return;

            // Check for mute command
            if (userID === "user-vfspuhk0" && msg.startsWith("/mute ")) {
                const targetID = msg.split(" ")[1];
                if (targetID && !mutedUsers.includes(targetID)) {
                    mutedUsers.push(targetID);
                    localStorage.setItem("muted_users", JSON.stringify(mutedUsers));
                    alert(`User ${targetID} muted.`);
                }
                msgInput.value = "";
                loadChat();
                return;
            }

            const chat = JSON.parse(localStorage.getItem("chat")) || [];
            chat.push({ user: name, msg, userID });
            localStorage.setItem("chat", JSON.stringify(chat));

            msgInput.value = "";
            loadChat();
        }

        function postAnnouncement(event) {
            event.preventDefault();
            const annInput = document.getElementById("announcement");
            const ann = annInput.value.trim();
            if (!ann) return;

            const announcements = JSON.parse(localStorage.getItem("announcements")) || [];
            announcements.push(ann);
            localStorage.setItem("announcements", JSON.stringify(announcements));

            annInput.value = "";
            loadAnnouncements();
        }

        function loadAnnouncements() {
            const announcements = JSON.parse(localStorage.getItem("announcements")) || [];
            const list = document.getElementById("announcement-list");
            list.innerHTML = announcements.map(a => `<li>ðŸ“¢ ${a}</li>`).join('');
        }

        // Load on start
        loadChat();
        loadAnnouncements();
    </script>
</body>
</html>
