<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AllPlay Chat</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="chat-container">
    <div class="header">
      <h1>AllPlay Chat</h1>
      <p id="userIdDisplay"></p>
    </div>
    <div class="chat-box" id="chatBox"></div>
    <input type="text" id="msgInput" placeholder="Type a message or command..." autocomplete="off"/>
    <button onclick="sendMessage()">Send</button>
  </div>

  <script>
    const userID = getOrSetUserID();
    const msgInput = document.getElementById("msgInput");
    const chatBox = document.getElementById("chatBox");
    const userIdDisplay = document.getElementById("userIdDisplay");

    function getOrSetUserID() {
      let id = localStorage.getItem("userID");
      if (!id) {
        id = "user-" + Math.random().toString(36).substr(2, 9);
        localStorage.setItem("userID", id);
      }
      return id;
    }

    function getMuteList() {
      return JSON.parse(localStorage.getItem("muted_users") || "{}");
    }

    function saveMuteList(mutes) {
      localStorage.setItem("muted_users", JSON.stringify(mutes));
    }

    function isMuted(uid) {
      const mutes = getMuteList();
      if (!mutes[uid]) return false;
      return Date.now() < mutes[uid];
    }

    function sendMessage() {
      const msg = msgInput.value.trim();

      if (!msg) return;

      // Mute Command
      if (userID === "user-vfspuhk0" && msg.startsWith("/mute ")) {
        const parts = msg.split(" ");
        const targetID = parts[1];
        const minutes = parseInt(parts[2]) || null;

        if (!targetID) {
          alert("Invalid command: use /mute [user-id] [optional minutes]");
          msgInput.value = "";
          return;
        }

        if (targetID === userID) {
          alert("You can't mute yourself, bro. That's illegal ðŸ’€");
          msgInput.value = "";
          return;
        }

        const mutes = getMuteList();
        const until = minutes
          ? Date.now() + minutes * 60000
          : Date.now() + 999 * 365 * 24 * 60 * 60000;

        mutes[targetID] = until;
        saveMuteList(mutes);
        alert(`Muted ${targetID} for ${minutes ? minutes + " minutes" : "a long time"}!`);
        msgInput.value = "";
        loadChat();
        return;
      }

      // Unmute Command
      if (userID === "user-vfspuhk0" && msg.startsWith("/unmute ")) {
        const parts = msg.split(" ");
        const targetID = parts[1];
        const mutes = getMuteList();
        if (mutes[targetID]) {
          delete mutes[targetID];
          saveMuteList(mutes);
          alert(`Unmuted ${targetID}`);
          loadChat();
        }
        msgInput.value = "";
        return;
      }

      const data = {
        user: userID,
        text: msg,
        time: Date.now()
      };

      let messages = JSON.parse(localStorage.getItem("chat") || "[]");
      messages.push(data);
      localStorage.setItem("chat", JSON.stringify(messages));
      msgInput.value = "";
      loadChat();
    }

    function loadChat() {
      const messages = JSON.parse(localStorage.getItem("chat") || "[]");
      chatBox.innerHTML = "";

      messages.forEach(msg => {
        if (isMuted(msg.user)) return;
        const div = document.createElement("div");
        div.className = "msg";
        div.innerHTML = `<strong>${msg.user}</strong>:
          ${msg.text}
          <button onclick="copyID('${msg.user}')">ðŸ“‹</button>`;
        chatBox.appendChild(div);
      });

      chatBox.scrollTop = chatBox.scrollHeight;
    }

    function copyID(id) {
      navigator.clipboard.writeText(id).then(() => {
        alert("Copied ID: " + id);
      });
    }

    // Show user ID
    userIdDisplay.innerHTML = `Your ID: <code>${userID}</code> <button onclick="copyID('${userID}')">ðŸ“‹</button>`;

    loadChat();
    setInterval(loadChat, 2000); // auto-refresh every 2 sec
  </script>
</body>
</html>
